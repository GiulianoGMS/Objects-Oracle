CREATE OR REPLACE VIEW CONSINCO.NAGV_COMPARATIVO_CD AS
SELECT translate(CODPOS,' .-', ' ')  COD_COMPLETO, NROEMPRESA, 1 SEQINVLOTE
FROM (
SELECT '0000000'||LPAD(PC.CODACESSO,13,0)||REPLACE(LPAD(A.DIVERGENCIA,8,0),'-','') CODPOS,
       A.DIVERGENCIA DIVERG, A.NROEMPRESA

  FROM CONSINCO.NAGV_INCONSISTENCIAS_INVCD A INNER JOIN (SELECT PCC.SEQPRODUTO, PCC.CODACESSO, ROW_NUMBER() OVER(PARTITION BY PCC.SEQPRODUTO ORDER BY PCC.SEQPRODUTO) ODR FROM
       CONSINCO.MAP_PRODCODIGO PCC WHERE PCC.QTDEMBALAGEM = 1 AND PCC.TIPCODIGO IN ('E', 'B')) PC ON A.SEQPRODUTO = PC.SEQPRODUTO AND PC.ODR = 1 AND CODACESSO NOT LIKE '0%'

 WHERE 1=1)

WHERE DIVERG > 0;
