CREATE OR REPLACE VIEW MRLV_ETIQ_NAGUMO_HIBRIDO_VM5 AS
SELECT /*+OPTIMIZER_FEATURES_ENABLE('11.2.0.4')*/
        -- Novo modelo criado por Giuliano | 28/05/2025

       NULL MARCA, A."NROEMPRESA",A."SEQPRODUTO",A."DTABASEPRECO",A."CODACESSO",A."QTDETIQUETA",A."DTAPROMINICIO",
       A."DTAPROMFIM",A."CODACESSOPADRAO",A."EMBALAGEMPADRAO",A."PADRAOEMBVENDA",A."PRECOEMBPADRAO",A.PRECOVALIDNORMAL,A.PRECOVALIDPROMOC,A."MULTEQPEMBPADRAO",
       A."QTDUNIDEMBPADRAO",A."TIPOETIQUETA",A."TIPOPRECO",A."DESCCOMPLETA",A."DESCREDUZIDA",A."QTDEMBALAGEM1",A."MULTEQPEMB1",
       A."QTDUNIDEMB1",A."QTDEMBALAGEM2",A."MULTEQPEMB2",A."QTDUNIDEMB2",A."QTDEMBALAGEM3",A."MULTEQPEMB3",A."QTDUNIDEMB3",
       A."QTDEMBALAGEM4",A."MULTEQPEMB4",A."QTDUNIDEMB4",A."QTDEMBALAGEM5",A."MULTEQPEMB5",A."QTDUNIDEMB5",A."CODACESSO1",A."CODACESSO2",
       A."CODACESSO3",A."CODACESSO4",A."CODACESSO5",A."PRECO1",A."PRECO2",A."PRECO3",A."PRECO4",A."PRECO5",A."PRECOMIN",A."PRECOMAX",
       A."EMBALAGEM1",A."EMBALAGEM2",A."EMBALAGEM3",A."EMBALAGEM4",A."EMBALAGEM5",A."TIPOCODIGO", A.QTDEMBCODACESSO,


       '^XA' || '^PRA^FS' || '^LH00,00^FS'|| '^BY2^FS' || '^PQ' || NVL(A.QTDETIQUETA, 1) || '^FS'
       || CASE


--======= Quando existir Meu Nagumo e Oferta Normal

          WHEN (NVL(J.PRECOVALIDPROMOC,0) > 0) AND (NVL(J.PRECOVALIDPROMOC,0))  < TRUNC((A.PRECOVALIDNORMAL * A.PADRAOEMBVENDA),2) AND J.QTDEMBALAGEM = 1 AND RPM.PRECOPPROMOCIONAL IS NOT NULL -- Se tem MN
               THEN
       -- ALTERADO POR GIULIANO | TRATAMENTO PRECO MEU NAGUMO
       CASE WHEN RPM.PRECOPPROMOCIONAL < NVL(J.PRECOVALIDPROMOC,0) AND PRECOPPROMOCIONAL > 0-- SE EXISTIR MEU NAGUMO, FORMA OFERTA + MEU NAGUMO E FOR MENOR QUE OFERTA NORMAL

       THEN                                   CHR(13) || CHR(10) ||
        '^FO90,115^GB150,4,4^FS'           || CHR(13) || CHR(10) || -- RISCO
        '^FO050,190^BY2.4^BEN,25,Y,N^FD'||A.CODACESSOPADRAO||'^FS' || CHR(13) || CHR(10) || -- EAN
        '^FO50,20^A0N,40,40^FD'||SUBSTR(A.DESCCOMPLETA,0,40) ||' '||CASE WHEN J.QTDEMBALAGEM > 1 THEN J.EMBALAGEM ELSE NULL END||'^FS' || CHR(13) || CHR(10) || -- DESC
        '^FO30,251^A0N,20,20^FD'||TO_CHAR(SYSDATE, 'DD/MM/YY HH24:MI')||'   Produto: '||A.SEQPRODUTO||'   Val. Prom.: '||
                                TO_CHAR(NAGF_INICIOPROMETIQUETA(A.NROEMPRESA, A.SEQPRODUTO, J.PRECOVALIDPROMOC), 'DD/MM/YY')||' a ' ||
                                TO_CHAR(NAGF_FIMPROMETIQUETA   (A.NROEMPRESA, A.SEQPRODUTO, J.PRECOVALIDPROMOC), 'DD/MM/YY')|| ' H  LJ: ' || G.NOMEREDUZIDO||'^FS' || CHR(13) || CHR(10) ||
        '^FO275,90^A0N,35,35^FDOFERTA^FS'  || CHR(13) || CHR(10) ||
        '^FO490,100^A0N,30,30^FD  R$  ^FS' || CHR(13) || CHR(10) ||
        '^FO495,76^A0N,20,20^FD  POR  ^FS' || CHR(13) || CHR(10) ||
        '^FO580,73^A0N,58,58^FD'||LPAD(TRUNC(J.PRECOVALIDPROMOC), 4, ' ' ) || ',' || LPAD((J.PRECOVALIDPROMOC - TRUNC(J.PRECOVALIDPROMOC)) * 100, 2, 0)||'^FS' || CHR(13) || CHR(10) || -- PROMOC
        (CASE WHEN J.MULTEQPEMB IS NOT NULL  OR J.MULTEQPEMBALAGEM IS NOT NULL THEN
        '^FO590,128^A0N,15,15^FDNesta Embalagem '||
                                CASE WHEN J.MULTEQPEMBALAGEM = 'LI' THEN 'LITRO' WHEN  J.MULTEQPEMBALAGEM = 'GR' THEN '100g' WHEN J.MULTEQPEMBALAGEM = 'ML' THEN '100ml' ELSE J.MULTEQPEMBALAGEM END ||' R$ ' ||
                                DECODE(SIGN(J.PRECOGERPROMOC),+1,
                                TRANSLATE(TO_CHAR(ROUND((J.PRECOGERPROMOC/(J.MULTEQPEMB*1000)) * CASE WHEN J.MULTEQPEMBALAGEM IN ('GR','ML') THEN 100000 ELSE 1000 END ,2),'FM9990.00'), '.', ','),
                                TRANSLATE(TO_CHAR(ROUND((J.PRECOGERNORMAL/(J.MULTEQPEMB*1000)) * CASE WHEN J.MULTEQPEMBALAGEM IN ('GR','ML') THEN 100000 ELSE 1000 END ,2),'FM9990.00'), '.', ','))  END )||'^FS' || CHR(13) || CHR(10) ||
        '^FO690,85^A0N,090,40^FD  ^FS'     || CHR(13) || CHR(10) ||
        '^FO50,95^A0N,25,25^FDR$^FS'       || CHR(13) || CHR(10) ||
        '^FO51,125^A0N,20,20^FDDE^FS'      || CHR(13) || CHR(10) ||
        '^FO70,92^A0N,60,60^^FD'||LPAD(TRUNC(J.PRECOVALIDNORMAL), 4, ' ' ) || ',' || LPAD((J.PRECOVALIDNORMAL - TRUNC(J.PRECOVALIDNORMAL)) * 100, 2, '0')|| '^FS' || CHR(13) || CHR(10) || -- PRECO NORMAL
        '^FO260,60^GB230,85,1^FS'          || CHR(13) || CHR(10) ||
        '^FO260,155^GB530,85,1^FS'         || CHR(13) || CHR(10) ||
        '^FO490,195^A0N,30,30^FD  R$  ^FS' || CHR(13) || CHR(10) ||
        '^FO495,175^A0N,20,20^FD  POR  ^FS'|| CHR(13) || CHR(10) ||
        (SELECT LT_IMG FROM CONSINCO.NAGT_LT_IMG) || CHR(13) || CHR(10) || -- Imagem
        '^FO400,204^A0N,20,20^FDExclusivo ^FS' || CHR(13) || CHR(10) ||
        '^FO580,167^A0N,58,58^FD'||LPAD(TRUNC(RPM.PRECOPPROMOCIONAL), 4, ' ' ) || ','||
                                   LPAD((RPM.PRECOPPROMOCIONAL -
                                   TRUNC(RPM.PRECOPPROMOCIONAL)) * 100, 2, 0)||'^FR^FS'|| CHR(13) || CHR(10) ||
        (CASE WHEN J.MULTEQPEMB IS NOT NULL  OR J.MULTEQPEMBALAGEM IS NOT NULL THEN
        '^FO590,221^A0N,15,15^FDNesta Embalagem '||
                                CASE WHEN J.MULTEQPEMBALAGEM = 'LI' THEN 'LITRO' WHEN  J.MULTEQPEMBALAGEM = 'GR' THEN '100g' WHEN J.MULTEQPEMBALAGEM = 'ML' THEN '100ml' ELSE J.MULTEQPEMBALAGEM END ||' R$ ' ||
                                DECODE(SIGN(RPM.PRECOPPROMOCIONAL),+1,
                                TRANSLATE(TO_CHAR(ROUND((RPM.PRECOPPROMOCIONAL/(J.MULTEQPEMB*1000)) * CASE WHEN J.MULTEQPEMBALAGEM IN ('GR','ML') THEN 100000 ELSE 1000 END ,2),'FM9990.00'), '.', ','),
                                TRANSLATE(TO_CHAR(ROUND((RPM.PRECOPPROMOCIONAL/(J.MULTEQPEMB*1000)) * CASE WHEN J.MULTEQPEMBALAGEM IN ('GR','ML') THEN 100000 ELSE 1000 END ,2),'FM9990.00'), '.', ',')) END)||'^FS'|| CHR(13) || CHR(10) ||
        '^FO490,155^GB300,86,51^FR^FS'     || CHR(13) || CHR(10) ||
        '^FO490,60^GB300,85,50^FR^FS'

        END
--======= Em promocao e a Promocao e MENOR que o PRECO NORMAL, e nao existe Preco A Partir De em Combos Promocionais
       -- Tipo A

         WHEN NVL(J.PRECOVALIDPROMOC,0) > 0
          AND NVL(J.PRECOVALIDPROMOC,0)  / J.QTDEMBALAGEM  < (J.PRECOVALIDNORMAL / J.QTDEMBALAGEM)
          AND PPDV.PRECOPROMOCAO IS NULL

         THEN

       -- OFERTA NORMAL
                                             CHR(13) || CHR(10) ||
        '^FO90,115^GB150,4,4^FS'          || CHR(13) || CHR(10) ||-- RISCO
        '^FO050,170^BY2.4^BEN,25,Y,N^FD'||CASE WHEN J.QTDEMBALAGEM > 1 THEN NVL(NAGF_BUSCADUN(A.SEQPRODUTO, J.QTDEMBALAGEM), 0) ELSE A.CODACESSOPADRAO END||'^FS'|| CHR(13) || CHR(10) ||
        '^FO50,20^A0N,40,40^FD'||SUBSTR(A.DESCCOMPLETA,0,40) ||' '||CASE WHEN J.QTDEMBALAGEM > 1 THEN J.EMBALAGEM ELSE NULL END||'^FS' || CHR(13) || CHR(10) ||
        '^FO50,251^A0N,20,20^FD'||TO_CHAR(SYSDATE, 'DD/MM/YY HH24:MI')||'   Produto: '||A.SEQPRODUTO||'   Val. Prom.: '||
                                TO_CHAR(NAGF_INICIOPROMETIQUETA(A.NROEMPRESA, A.SEQPRODUTO, J.PRECOVALIDPROMOC), 'DD/MM/YY')||' a ' ||
                                TO_CHAR(NAGF_FIMPROMETIQUETA   (A.NROEMPRESA, A.SEQPRODUTO, J.PRECOVALIDPROMOC), 'DD/MM/YY')||
                                ' A'|| '  LJ: ' || G.NOMEREDUZIDO||'^FS' || CHR(13) || CHR(10) ||
        '^FO275,120^A0N,80,60^FDOFERTA^FS'|| CHR(13) || CHR(10) ||
        '^FO490,100^A0N,30,30^FD  R$  ^FS'|| CHR(13) || CHR(10) ||
        '^FO495,76^A0N,20,20^FD  POR  ^FS'|| CHR(13) || CHR(10) ||
        -- TRATATIVA LENGTH - TAMANHO PRECO PROMOC
        (CASE WHEN J.PRECOVALIDPROMOC > 99.99
        THEN
        '^FO515,90^A0N,130,90^FD'||LPAD(TRUNC(J.PRECOVALIDPROMOC), 4, ' ' ) || ',' || LPAD((J.PRECOVALIDPROMOC - TRUNC(J.PRECOVALIDPROMOC)) * 100, 2, 0)||'^FS'
        ELSE
        '^FO475,80^A0N,150,110^FD'||LPAD(TRUNC(J.PRECOVALIDPROMOC), 4, ' ' ) || ',' || LPAD((J.PRECOVALIDPROMOC - TRUNC(J.PRECOVALIDPROMOC)) * 100, 2, 0)||'^FS' END)|| CHR(13) || CHR(10) || -- PROMOC
        (CASE WHEN J.MULTEQPEMB IS NOT NULL  OR J.MULTEQPEMBALAGEM IS NOT NULL THEN
        '^FO590,215^A0N,15,15^FDNesta Embalagem '||
                                CASE WHEN J.MULTEQPEMBALAGEM = 'LI' THEN 'LT' WHEN  J.MULTEQPEMBALAGEM = 'GR' THEN '100g' WHEN J.MULTEQPEMBALAGEM = 'ML' THEN '100ml' ELSE J.MULTEQPEMBALAGEM END ||' R$ ' ||
                                DECODE(SIGN(J.PRECOGERPROMOC),+1,
                                TRANSLATE(TO_CHAR(ROUND((J.PRECOGERPROMOC/(J.MULTEQPEMB*1000)) * CASE WHEN J.MULTEQPEMBALAGEM IN ('GR','ML') THEN 100000 ELSE 1000 END ,2),'FM9990.00'), '.', ','),
                                TRANSLATE(TO_CHAR(ROUND((J.PRECOGERNORMAL/(J.MULTEQPEMB*1000)) * CASE WHEN J.MULTEQPEMBALAGEM IN ('GR','ML') THEN 100000 ELSE 1000 END ,2),'FM9990.00'), '.', ','))END )||'^FS' || CHR(13) || CHR(10) ||
        '^FO690,85^A0N,090,40^FD  ^FS'    || CHR(13) || CHR(10) ||
        '^FO50,95^A0N,25,25^FDR$^FS'      || CHR(13) || CHR(10) ||
        '^FO51,125^A0N,20,20^FDDE^FS'     || CHR(13) || CHR(10) ||
        '^FO70,92^A0N,60,60^FD'||LPAD(TRUNC(J.PRECOVALIDNORMAL), 4, ' ' ) || ',' || LPAD((J.PRECOVALIDNORMAL - TRUNC(J.PRECOVALIDNORMAL)) * 100, 2, '0')|| '^FS' || CHR(13) || CHR(10) || -- PRECO NORMAL
        '^FO260,60^GB230,180,1^FS'        || CHR(13) || CHR(10) ||
        '^FO490,60^GB300,180,100^FR^FS'

--======== INICIO OFERTAS EXCLUSIVAS - APENAS MEU NAGUMO SEM OFERTA C5 - 02/09/2024 - Giuliano ========--

         WHEN NVL(J.PRECOVALIDPROMOC,0) = 0 AND RPM.PRECOPPROMOCIONAL < TRUNC((A.PRECOVALIDNORMAL * A.PADRAOEMBVENDA),2) AND PRECOPPROMOCIONAL > 0 AND J.QTDEMBALAGEM = 1 AND RPM.PRECOPPROMOCIONAL IS NOT NULL -- Se tem MN
         THEN                                   CHR(13) || CHR(10) ||
        '^FO50,20^A0N,40,40^FD'||SUBSTR(A.DESCCOMPLETA,0,37) ||' '||CASE WHEN J.QTDEMBALAGEM > 1 THEN J.EMBALAGEM ELSE NULL END||'^FS' || CHR(13) || CHR(10) || -- DESC
        '^FO50,251^A0N,20,20^FD'||TO_CHAR(SYSDATE, 'DD/MM/YY HH24:MI')||'   Produto: '||A.SEQPRODUTO||'   Val. Prom.: '||
                                  TO_CHAR(RPM.DTINICIO, 'DD/MM/YY')||' a ' ||
                                  TO_CHAR(RPM.DTFIM,    'DD/MM/YY')|| ' I  LJ: ' || G.NOMEREDUZIDO||'^FS' || CHR(13) || CHR(10) ||
        '^FO285,80^A0N,18,18^FD- PRECO EXCLUSIVO -^FS'|| CHR(13) || CHR(10) ||
        '^FO330,100^A0N,15,15^FDPARA CLIENTE^FS'|| CHR(13) || CHR(10) ||
        '^FO310,185^A0N,18,18^FDCADASTRE-SE E^FS'|| CHR(13) || CHR(10) ||
        '^FO290,210^A0N,15,15^FDINFORME O CPF NO CAIXA^FS'|| CHR(13) || CHR(10) ||
        '^FO490,100^A0N,30,30^FD  R$  ^FS'|| CHR(13) || CHR(10) ||
        '^FO495,76^A0N,20,20^FD  POR  ^FS'|| CHR(13) || CHR(10) ||
        -- TRATATIVA LENGTH - TAMANHO PRECO PROMOC ATIVAVEL
        (CASE WHEN J.PRECOVALIDPROMOC > 99.99
        THEN
        '^FO515,80^A0N,150,110^FD'||LPAD(TRUNC(RPM.PRECOPPROMOCIONAL), 4, ' ' ) || ',' || LPAD((RPM.PRECOPPROMOCIONAL - TRUNC(RPM.PRECOPPROMOCIONAL)) * 100, 2, '0')|| '^FS'
        ELSE
        '^FO475,80^A0N,150,110^FD'||LPAD(TRUNC(RPM.PRECOPPROMOCIONAL), 4, ' ' ) || ',' || LPAD((RPM.PRECOPPROMOCIONAL - TRUNC(RPM.PRECOPPROMOCIONAL)) * 100, 2, '0')|| '^FS' END)|| CHR(13) || CHR(10) || -- PROMOC
        (CASE WHEN J.MULTEQPEMB IS NOT NULL  OR J.MULTEQPEMBALAGEM IS NOT NULL THEN
        '^FO590,215^A0N,15,15^FDNesta Embalagem '||
                                CASE WHEN J.MULTEQPEMBALAGEM = 'LI' THEN 'LITRO' WHEN  J.MULTEQPEMBALAGEM = 'GR' THEN '100g' WHEN J.MULTEQPEMBALAGEM = 'ML' THEN '100ml' ELSE J.MULTEQPEMBALAGEM END ||' R$ ' ||
                                DECODE(SIGN(J.PRECOGERPROMOC),+1,
                                TRANSLATE(TO_CHAR(ROUND((RPM.PRECOPPROMOCIONAL/(J.MULTEQPEMB*1000)) * CASE WHEN J.MULTEQPEMBALAGEM IN ('GR','ML') THEN 100000 ELSE 1000 END ,2),'FM9990.00'), '.', ','),
                                TRANSLATE(TO_CHAR(ROUND((RPM.PRECOPPROMOCIONAL/(J.MULTEQPEMB*1000)) * CASE WHEN J.MULTEQPEMBALAGEM IN ('GR','ML') THEN 100000 ELSE 1000 END ,2),'FM9990.00'), '.', ','))END)||'^FS' || CHR(13) || CHR(10) ||
        '^FO690,85^A0N,090,40^FD  ^FS'|| CHR(13) || CHR(10) ||
        '^FO050,190^BY2.4^BEN,25,Y,N^FD'||A.CODACESSOPADRAO||'^FS'|| CHR(13) || CHR(10) ||
        '^FO50,95^A0N,25,25^FDR$^FS'|| CHR(13) || CHR(10) ||
        '^FO51,125^A0N,20,20^FD^FS'|| CHR(13) || CHR(10) ||
        '^FO270,75,0^'||(SELECT LT_IMG FROM CONSINCO.NAGT_LT_IMG3 WHERE TIPO = 4) || CHR(13) || CHR(10) || -- Imagem MN
        -- TRATATIVA LENGTH - TAMANHO PRECO NORMAL
        (CASE WHEN J.PRECOVALIDNORMAL > 99.99
        THEN
        '^FO40,75^A0N,62,62^FD'||LPAD(TRUNC(J.PRECOVALIDNORMAL), 4, ' ' ) || ',' || LPAD((J.PRECOVALIDNORMAL - TRUNC(J.PRECOVALIDNORMAL)) * 100, 2, '0')|| '^FS'
        ELSE
        '^FO40,70^A0N,72,72^FD'||LPAD(TRUNC(J.PRECOVALIDNORMAL), 4, ' ' ) || ',' || LPAD((J.PRECOVALIDNORMAL - TRUNC(J.PRECOVALIDNORMAL)) * 100, 2, '0')|| '^FS' END)|| CHR(13) || CHR(10) || -- PRECO NORMAL
        '^FO85,145^A0N,15,15^FDPRECO PARA NAO^FS'|| CHR(13) || CHR(10) ||
        '^FO65,165^A0N,15,15^FDMEMBROS MEU NAGUMO^FS'|| CHR(13) || CHR(10) ||
        '^FO260,60^GB230,180,1^FS'|| CHR(13) || CHR(10) ||
        '^FO490,60^GB300,180,100^FR^FS'

--======= Combos Promocionais - A Partir de por CAIXA
       -- Preco Combo menor que oferta e preco normal
       -- Tipo B

         WHEN J.QTDEMBALAGEM > 1 AND J.QTDEMBALAGEM >= PPDV.QTDAPARTIRDE
          AND NVL(PPDV.PRECOPROMOCAO,0) < NVL(NULLIF(J.PRECOVALIDPROMOC,0), J.PRECOVALIDNORMAL)
          AND NVL(PPDV.PRECOPROMOCAO,0) > 0
          AND PPDV.INDTIPOQTDCARGAPDV = 'A'
          AND PPDV.CODPARCEIRO IS NULL

         THEN
                                             CHR(13) || CHR(10) ||
        '^FO90,115^GB150,4,4^FS'          || CHR(13) || CHR(10) ||-- RISCO
        '^FO050,170^BY2.4^BEN,25,Y,N^FD'||CASE WHEN J.QTDEMBALAGEM > 1 THEN NVL(NAGF_BUSCADUN(A.SEQPRODUTO, J.QTDEMBALAGEM), 0) ELSE A.CODACESSOPADRAO END||'^FS'|| CHR(13) || CHR(10) ||
        '^FO50,20^A0N,40,40^FD'||SUBSTR(A.DESCCOMPLETA,0,40)||'^FS' || CHR(13) || CHR(10) ||
        '^FO50,251^A0N,20,20^FD'||TO_CHAR(SYSDATE, 'DD/MM/YY HH24:MI')||'   Produto: '||A.SEQPRODUTO||'   Val. Prom.: '||
                                TO_CHAR(PPDV.DTAINICIO, 'DD/MM/YY')||' a ' ||
                                TO_CHAR(PPDV.DTAFIM, 'DD/MM/YY')||
                                ' B'||'  LJ: ' || G.NOMEREDUZIDO||'^FS' || CHR(13) || CHR(10) ||
        '^FO280,85^A0N,80,60^FDOFERTA^FS' || CHR(13) || CHR(10) ||
        '^FO320,160^A0N,30,30^FDATACADO^FS' || CHR(13) || CHR(10) ||
        '^FO285,195^A0N,20,20^FDNA CAIXA COM '||LPAD(J.QTDEMBALAGEM,2,0)||CASE WHEN J.PESAVEL = 'S' THEN ' KG' ELSE ' UNID.' END||'^FS' || CHR(13) || CHR(10) ||
        '^FO490,100^A0N,30,30^FD  R$  ^FS'|| CHR(13) || CHR(10) ||
        '^FO495,76^A0N,20,20^FD  POR  ^FS'|| CHR(13) || CHR(10) ||
        -- TRATATIVA LENGTH - TAMANHO PRECO PROMOC
        (CASE WHEN (PPDV.PRECOPROMOCAO * J.QTDEMBALAGEM) > 99.99
        THEN
        '^FO515,90^A0N,130,90^FD'||LPAD(TRUNC((PPDV.PRECOPROMOCAO * J.QTDEMBALAGEM)), 4, ' ' ) || ',' || LPAD(((PPDV.PRECOPROMOCAO * J.QTDEMBALAGEM) - TRUNC((PPDV.PRECOPROMOCAO * J.QTDEMBALAGEM))) * 100, 2, 0)||'^FS'
        ELSE
        '^FO475,80^A0N,150,110^FD'||LPAD(TRUNC((PPDV.PRECOPROMOCAO * J.QTDEMBALAGEM)), 4, ' ' ) || ',' || LPAD(((PPDV.PRECOPROMOCAO * J.QTDEMBALAGEM) - TRUNC((PPDV.PRECOPROMOCAO * J.QTDEMBALAGEM))) * 100, 2, 0)||'^FS' END)|| CHR(13) || CHR(10) || -- PROMOC
        (CASE WHEN J.MULTEQPEMB IS NOT NULL  OR J.MULTEQPEMBALAGEM IS NOT NULL THEN
        '^FO590,215^A0N,15,15^FDNesta Embalagem '||
                                CASE WHEN J.MULTEQPEMBALAGEM = 'LI' THEN 'LT' WHEN  J.MULTEQPEMBALAGEM = 'GR' THEN '100g' WHEN J.MULTEQPEMBALAGEM = 'ML' THEN '100ml' ELSE J.MULTEQPEMBALAGEM END ||' R$ ' ||
                                DECODE(SIGN(PPDV.PRECOPROMOCAO),+1,
                                TRANSLATE(TO_CHAR(ROUND((PPDV.PRECOPROMOCAO/(J.MULTEQPEMB*1000)) * CASE WHEN J.MULTEQPEMBALAGEM IN ('GR','ML') THEN 100000 ELSE 1000 END ,2),'FM9990.00'), '.', ','),
                                TRANSLATE(TO_CHAR(ROUND((PPDV.PRECOPROMOCAO/(J.MULTEQPEMB*1000)) * CASE WHEN J.MULTEQPEMBALAGEM IN ('GR','ML') THEN 100000 ELSE 1000 END ,2),'FM9990.00'), '.', ','))END )||'^FS' || CHR(13) || CHR(10) ||
        '^FO690,85^A0N,090,40^FD  ^FS'    || CHR(13) || CHR(10) ||
        '^FO50,95^A0N,25,25^FDR$^FS'      || CHR(13) || CHR(10) ||
        '^FO51,125^A0N,20,20^FDDE^FS'     || CHR(13) || CHR(10) ||
        '^FO70,92^A0N,60,60^FD'||LPAD(TRUNC(A.PRECOEMBPADRAO * J.QTDEMBALAGEM), 4, ' ' ) || ',' || LPAD(((A.PRECOEMBPADRAO * J.QTDEMBALAGEM) - TRUNC(A.PRECOEMBPADRAO * J.QTDEMBALAGEM)) * 100, 2, '0')|| '^FS' || CHR(13) || CHR(10) || -- PRECO NORMAL
        '^FO260,60^GB230,180,1^FS'        || CHR(13) || CHR(10) ||
        '^FO490,60^GB300,180,100^FR^FS'

--======== Combos Promocionais - A Partir de por UNIDADE
       -- Tipo C

       WHEN J.QTDEMBALAGEM = 1
        AND NVL(PPDV.PRECOPROMOCAO,0) < NVL(NULLIF(J.PRECOVALIDPROMOC,0), J.PRECOVALIDNORMAL)
        AND NVL(PPDV.PRECOPROMOCAO,0) > 0
        AND PPDV.INDTIPOQTDCARGAPDV = 'A'
        AND PPDV.CODPARCEIRO IS NULL

       THEN
                                              CHR(13) || CHR(10) ||
        '^FO050,190^BY2.4^BEN,25,Y,N^FD'||CASE WHEN J.QTDEMBALAGEM > 1 THEN NVL(NAGF_BUSCADUN(A.SEQPRODUTO, J.QTDEMBALAGEM), 0) ELSE A.CODACESSOPADRAO END||'^FS' || CHR(13) || CHR(10) || -- EAN
        '^FO50,20^A0N,40,40^FD'||SUBSTR(A.DESCCOMPLETA,0,40) ||'^FS' || CHR(13) || CHR(10) || -- DESC
        '^FO30,251^A0N,20,20^FD'||TO_CHAR(SYSDATE, 'DD/MM/YY HH24:MI')||'   Produto: '||A.SEQPRODUTO||'   Val. Prom.: '||
                                TO_CHAR(PPDV.DTAINICIO, 'DD/MM/YY')||' a ' ||
                                TO_CHAR(PPDV.DTAFIM, 'DD/MM/YY')||
                                ' C'||'  LJ: ' || G.NOMEREDUZIDO||'^FS' || CHR(13) || CHR(10) ||
        '^FO275,80^A0N,33,33^FDVAREJO^FS'  || CHR(13) || CHR(10) ||
        '^FO275,115^A0N,19,19^FD'||CASE WHEN J.PESAVEL = 'S' THEN 'KG' ELSE 'UNITARIO' END||'^FS' || CHR(13) || CHR(10) ||
        '^FO490,100^A0N,30,30^FD  R$  ^FS' || CHR(13) || CHR(10) ||
        '^FO495,76^A0N,20,20^FD  CADA  ^FS' || CHR(13) || CHR(10) ||
        '^FO580,73^A0N,58,58^FD'||LPAD(TRUNC(A.PRECOEMBPADRAO * J.QTDEMBALAGEM), 4, ' ' ) || ',' ||
                                                                LPAD(((A.PRECOEMBPADRAO * J.QTDEMBALAGEM) - TRUNC((A.PRECOEMBPADRAO * J.QTDEMBALAGEM
                                                                ))) * 100, 2, 0)||'^FS' || CHR(13) || CHR(10) || -- PROMOC
        (CASE WHEN J.MULTEQPEMB IS NOT NULL  OR J.MULTEQPEMBALAGEM IS NOT NULL THEN
        '^FO590,128^A0N,15,15^FDNesta Embalagem '||
                                CASE WHEN J.MULTEQPEMBALAGEM = 'LI' THEN 'LT' WHEN  J.MULTEQPEMBALAGEM = 'GR' THEN '100g' WHEN J.MULTEQPEMBALAGEM = 'ML' THEN '100ml' ELSE J.MULTEQPEMBALAGEM END ||' R$ ' ||
                                DECODE(SIGN(A.PRECOEMBPADRAO * J.QTDEMBALAGEM),+1,
                                TRANSLATE(TO_CHAR(ROUND(((A.PRECOEMBPADRAO * J.QTDEMBALAGEM)/(J.MULTEQPEMB*1000)) * CASE WHEN J.MULTEQPEMBALAGEM IN ('GR','ML') THEN 100000 ELSE 1000 END ,2),'FM9990.00'), '.', ','),
                                TRANSLATE(TO_CHAR(ROUND(((A.PRECOEMBPADRAO * J.QTDEMBALAGEM)/(J.MULTEQPEMB*1000)) * CASE WHEN J.MULTEQPEMBALAGEM IN ('GR','ML') THEN 100000 ELSE 1000 END ,2),'FM9990.00'), '.', ','))  END )||'^FS' || CHR(13) || CHR(10) ||
        '^FO690,85^A0N,090,40^FD  ^FS'     || CHR(13) || CHR(10) ||
        '^FO260,60^GB230,85,1^FS'          || CHR(13) || CHR(10) ||
        '^FO260,155^GB530,85,1^FS'         || CHR(13) || CHR(10) ||
        '^FO490,195^A0N,30,30^FD  R$  ^FS' || CHR(13) || CHR(10) ||
        '^FO495,172^A0N,20,20^FD  CADA  ^FS'|| CHR(13) || CHR(10) ||
        '^FO275,175^A0N,33,33^FDATACADO^FS'|| CHR(13) || CHR(10) ||
        '^FO275,210^A0N,19,19^FDA PARTIR DE '||PPDV.QTDE||'^FS'|| CHR(13) || CHR(10) ||
        '^FO580,167^A0N,58,58^FD'||LPAD(TRUNC(PPDV.PRECOPROMOCAO * J.QTDEMBALAGEM), 4, ' ' ) || ','||
                                   LPAD(((PPDV.PRECOPROMOCAO * J.QTDEMBALAGEM) -
                                   TRUNC((PPDV.PRECOPROMOCAO * J.QTDEMBALAGEM))) * 100, 2, 0)||'^FR^FS'|| CHR(13) || CHR(10) ||
        (CASE WHEN J.MULTEQPEMB IS NOT NULL  OR J.MULTEQPEMBALAGEM IS NOT NULL THEN
        '^FO590,221^A0N,15,15^FDNesta Embalagem '||
                                CASE WHEN J.MULTEQPEMBALAGEM = 'LI' THEN 'LT' WHEN  J.MULTEQPEMBALAGEM = 'GR' THEN '100g' WHEN J.MULTEQPEMBALAGEM = 'ML' THEN '100ml' ELSE J.MULTEQPEMBALAGEM END ||' R$ ' ||
                                DECODE(SIGN(PPDV.PRECOPROMOCAO * J.QTDEMBALAGEM),+1,
                                TRANSLATE(TO_CHAR(ROUND(((PPDV.PRECOPROMOCAO * J.QTDEMBALAGEM)/(J.MULTEQPEMB*1000)) * CASE WHEN J.MULTEQPEMBALAGEM IN ('GR','ML') THEN 100000 ELSE 1000 END ,2),'FM9990.00'), '.', ','),
                                TRANSLATE(TO_CHAR(ROUND(((PPDV.PRECOPROMOCAO * J.QTDEMBALAGEM)/(J.MULTEQPEMB*1000)) * CASE WHEN J.MULTEQPEMBALAGEM IN ('GR','ML') THEN 100000 ELSE 1000 END ,2),'FM9990.00'), '.', ',')) END)||'^FS'|| CHR(13) || CHR(10) ||
        '^FO490,155^GB300,86,51^FR^FS'     || CHR(13) || CHR(10) ||
        -- QrCode
        '^LH0,0^FO50,70^BQN,2,4 ^FDMA,'||CASE WHEN J.NROSEGMENTO NOT IN (8,4) THEN 'qrco.de/bg6UzU' ELSE 'qrco.de/bg0jxt' END||'^FS'     || CHR(13) || CHR(10) ||
        -- Imagem | Logo
        CASE WHEN J.NROSEGMENTO NOT IN (8,4) THEN
        '^FO150,80^GFA,780,780,10,,::::::N01FFE,M01JFC,M07KF8,L03MF,L0NF8,K01NFE,K07OF8,K0PFC,J01PFE,J03QF,J07QF8,J0RFC,I01RFE,I03KF00LF,I03JF8001KF,I07IFEJ07JF8,I0JFCJ03JFC,I0JFK01JFC,001IFEL0JFE,001IFCL07IFE,003IFCL03JF,003IF8L03JF,007IF8L01JF,007IFI07C001JF8,007IFI0FFI0JF8,007IF001FF800JF8,00IFE003FFC00JF8,00IFE003FFC007IFC,00IFE007FFC007IFC,:00IFE007FFE007IFC,:::::::::007FFE007FFE007IF8,:007FFE007FFE003IF8,007FFE007FFE001IF,003FFE007IFI01FF,:003FFE007IF8003FE,001FFE007IFC007FE,001IF00KF01FFC,I0TFC,I07SF8,:I03SF,I01RFE,I01RFC,J0RFC,J07QF8,J03QF,J01PFC,K0PF8,K03OF,L0NFC,L07MF8,L01LFE,M03KF,N07IF8,,::::^FS'
             WHEN J.NROSEGMENTO IN (8,4)     THEN
        '^FO145,50^GFA,960,960,12,,::::::::Q0FF8,O03JFE,N01LFC,N07MF,M01NFC,M07OF,M0PF8,L03PFE,L07QF,L0RF8,K01RFC,K03RFE,K07SF,K0IFC01FE00JF8,K0FFEI078003IF8,J01FFCI03J0IFC,J01FF8N07FFE,J03FFO03FFE,J03FEO03IF,J07FEO01IF,J07FCP0IF,J0FFC006I01800IF8,J0FF801F8007E00IF8,J0FF803FC00FF007FF8,:J0FF803FE01FF007FFC,J0FF807FE01FF007FFC,:I01FF807FE01FF007FFC,J0FF807FE01FF007FFC,:::J0FF807FE01FF007FF8,:J0FF807FE01FF003FF8,J07F807FE01FF8003F8,J07F807FE01FF8003F,J07F807FE01FFC007F,J03F807FE01FFE00FF,J03FC07FE03IF83FE,J01TFC,K0TFC,K0TF8,K07SF8,K07SF,K07RFE,K07RFC,K0SF8,K0SF,K0RFC,K0RF8,K0QFE,J01QFC,J01QF,J01IFC7KF8,J01FFE00JFC,J01FF8,J01FC,J03F,J038,J02,,::::::::^FS'
        END
        || CHR(13) || CHR(10) || '^FO490,60^GB300,85,50^FR^FS'

--======== Gerenciador de Precos - A Partir de por CAIXA
        -- Quando a Emb > 1 for mais barata que a unitaria
        -- Tipo D

         WHEN A.PRECOEMBPADRAO > P.PRECOVALIDNORMAL/ J.QTDEMBALAGEM
          AND A.PRECOVALIDNORMAL > 0
          AND J.PRECOVALIDNORMAL > 0
          AND J.QTDEMBALAGEM < NVL(PPDV.QTDAPARTIRDE,999)
          AND J.QTDEMBALAGEM > 1

         THEN
                                             CHR(13) || CHR(10) ||
        '^FO90,115^GB150,4,4^FS'          || CHR(13) || CHR(10) ||-- RISCO
        '^FO050,170^BY2.4^BEN,25,Y,N^FD'||CASE WHEN J.QTDEMBALAGEM > 1 THEN NVL(NAGF_BUSCADUN(A.SEQPRODUTO, J.QTDEMBALAGEM), 0) ELSE A.CODACESSOPADRAO END||'^FS'|| CHR(13) || CHR(10) ||
        '^FO50,20^A0N,40,40^FD'||SUBSTR(A.DESCCOMPLETA,0,40) ||'^FS' || CHR(13) || CHR(10) ||
        '^FO50,251^A0N,20,20^FD'||TO_CHAR(SYSDATE, 'DD/MM/YY HH24:MI')||'   Produto: '||A.SEQPRODUTO||
                                ' D'||' LJ: ' || G.NOMEREDUZIDO||'^FS' || CHR(13) || CHR(10) ||
        '^FO280,85^A0N,80,60^FDOFERTA^FS' || CHR(13) || CHR(10) ||
        '^FO320,160^A0N,30,30^FDATACADO^FS' || CHR(13) || CHR(10) ||
        '^FO285,195^A0N,20,20^FDNA CAIXA COM '||LPAD(J.QTDEMBALAGEM,2,0)||CASE WHEN J.PESAVEL = 'S' THEN ' KG' ELSE ' UNID.' END||'^FS' || CHR(13) || CHR(10) ||
        '^FO490,100^A0N,30,30^FD  R$  ^FS'|| CHR(13) || CHR(10) ||
        '^FO495,76^A0N,20,20^FD  POR  ^FS'|| CHR(13) || CHR(10) ||
        -- TRATATIVA LENGTH - TAMANHO PRECO PROMOC
        (CASE WHEN (P.PRECOVALIDNORMAL) > 99.99
        THEN
        '^FO515,90^A0N,130,90^FD'||LPAD(TRUNC((P.PRECOVALIDNORMAL)), 4, ' ' ) || ',' || LPAD(((P.PRECOVALIDNORMAL) - TRUNC((P.PRECOVALIDNORMAL))) * 100, 2, 0)||'^FS'
        ELSE
        '^FO475,80^A0N,150,110^FD'||LPAD(TRUNC((P.PRECOVALIDNORMAL)), 4, ' ' ) || ',' || LPAD(((P.PRECOVALIDNORMAL) - TRUNC((P.PRECOVALIDNORMAL))) * 100, 2, 0)||'^FS' END)|| CHR(13) || CHR(10) || -- PROMOC
        (CASE WHEN J.MULTEQPEMB IS NOT NULL  OR J.MULTEQPEMBALAGEM IS NOT NULL THEN
        '^FO590,215^A0N,15,15^FDNesta Embalagem '||
                                CASE WHEN J.MULTEQPEMBALAGEM = 'LI' THEN 'LT' WHEN  J.MULTEQPEMBALAGEM = 'GR' THEN '100g' WHEN J.MULTEQPEMBALAGEM = 'ML' THEN '100ml' ELSE J.MULTEQPEMBALAGEM END ||' R$ ' ||
                                DECODE(SIGN(P.PRECOVALIDNORMAL),+1,
                                TRANSLATE(TO_CHAR(ROUND((P.PRECOVALIDNORMAL/(J.MULTEQPEMB*1000)) * CASE WHEN J.MULTEQPEMBALAGEM IN ('GR','ML') THEN 100000 ELSE 1000 END ,2),'FM9990.00'), '.', ','),
                                TRANSLATE(TO_CHAR(ROUND((P.PRECOVALIDNORMAL/(J.MULTEQPEMB*1000)) * CASE WHEN J.MULTEQPEMBALAGEM IN ('GR','ML') THEN 100000 ELSE 1000 END ,2),'FM9990.00'), '.', ','))END )||'^FS' || CHR(13) || CHR(10) ||
        '^FO690,85^A0N,090,40^FD  ^FS'    || CHR(13) || CHR(10) ||
        '^FO50,95^A0N,25,25^FDR$^FS'      || CHR(13) || CHR(10) ||
        '^FO51,125^A0N,20,20^FDDE^FS'     || CHR(13) || CHR(10) ||
        '^FO70,92^A0N,60,60^FD'||LPAD(TRUNC(A.PRECOEMBPADRAO * J.QTDEMBALAGEM), 4, ' ' ) || ',' || LPAD(((A.PRECOEMBPADRAO * J.QTDEMBALAGEM) - TRUNC(A.PRECOEMBPADRAO * J.QTDEMBALAGEM)) * 100, 2, '0')|| '^FS' || CHR(13) || CHR(10) || -- PRECO NORMAL
        '^FO260,60^GB230,180,1^FS'        || CHR(13) || CHR(10) ||
        '^FO490,60^GB300,180,100^FR^FS'

--======== Gerenciador de Precos - A Partir de por UNIDADE
        -- Quando a Emb > 1 for mais barata que a unitaria
        -- Tipo E

       WHEN J.QTDEMBALAGEM = 1
          AND A.PRECOEMBPADRAO > ATAC.PRECOATAC
          AND ATAC.PRECOATAC > 0
          AND J.QTDEMBALAGEM < NVL(ATAC.QTDEMBALAGEM,999)

       THEN
                                              CHR(13) || CHR(10) ||
        '^FO050,190^BY2.4^BEN,25,Y,N^FD'||CASE WHEN J.QTDEMBALAGEM > 1 THEN NVL(NAGF_BUSCADUN(A.SEQPRODUTO, J.QTDEMBALAGEM), 0) ELSE A.CODACESSOPADRAO END||'^FS' || CHR(13) || CHR(10) || -- EAN
        '^FO50,20^A0N,40,40^FD'||SUBSTR(A.DESCCOMPLETA,0,40) ||'^FS' || CHR(13) || CHR(10) || -- DESC
        '^FO30,251^A0N,20,20^FD'||TO_CHAR(SYSDATE, 'DD/MM/YY HH24:MI')||'   Produto: '||A.SEQPRODUTO||
                                ' E'||' LJ: ' || G.NOMEREDUZIDO||'^FS' || CHR(13) || CHR(10) ||
        '^FO275,80^A0N,33,33^FDVAREJO^FS'  || CHR(13) || CHR(10) ||
        '^FO275,115^A0N,19,19^FD'||CASE WHEN J.PESAVEL = 'S' THEN 'KG' ELSE 'UNITARIO' END||'^FS' || CHR(13) || CHR(10) ||
        '^FO490,100^A0N,30,30^FD  R$  ^FS' || CHR(13) || CHR(10) ||
        '^FO495,76^A0N,20,20^FD  '||CASE WHEN J.PESAVEL = 'S' THEN 'KG' ELSE 'CADA' END||'  ^FS' || CHR(13) || CHR(10) ||
        '^FO580,73^A0N,58,58^FD'||LPAD(TRUNC(A.PRECOEMBPADRAO * J.QTDEMBALAGEM), 4, ' ' ) || ',' ||
                                                                LPAD(((A.PRECOEMBPADRAO * J.QTDEMBALAGEM) - TRUNC((A.PRECOEMBPADRAO * J.QTDEMBALAGEM
                                                                ))) * 100, 2, 0)||'^FS' || CHR(13) || CHR(10) || -- PROMOC
        (CASE WHEN J.MULTEQPEMB IS NOT NULL  OR J.MULTEQPEMBALAGEM IS NOT NULL THEN
        '^FO590,128^A0N,15,15^FDNesta Embalagem '||
                                CASE WHEN J.MULTEQPEMBALAGEM = 'LI' THEN 'LT' WHEN  J.MULTEQPEMBALAGEM = 'GR' THEN '100g' WHEN J.MULTEQPEMBALAGEM = 'ML' THEN '100ml' ELSE J.MULTEQPEMBALAGEM END ||' R$ ' ||
                                DECODE(SIGN(A.PRECOEMBPADRAO * J.QTDEMBALAGEM),+1,
                                TRANSLATE(TO_CHAR(ROUND(((A.PRECOEMBPADRAO * J.QTDEMBALAGEM)/(J.MULTEQPEMB*1000)) * CASE WHEN J.MULTEQPEMBALAGEM IN ('GR','ML') THEN 100000 ELSE 1000 END,2),'FM9990.00'), '.', ','),
                                TRANSLATE(TO_CHAR(ROUND(((A.PRECOEMBPADRAO * J.QTDEMBALAGEM)/(J.MULTEQPEMB*1000)) * CASE WHEN J.MULTEQPEMBALAGEM IN ('GR','ML') THEN 100000 ELSE 1000 END,2),'FM9990.00'), '.', ','))  END )||'^FS' || CHR(13) || CHR(10) ||
        '^FO690,85^A0N,090,40^FD  ^FS'     || CHR(13) || CHR(10) ||
        '^FO260,60^GB230,85,1^FS'          || CHR(13) || CHR(10) ||
        '^FO260,155^GB530,85,1^FS'         || CHR(13) || CHR(10) ||
        '^FO490,195^A0N,30,30^FD  R$  ^FS' || CHR(13) || CHR(10) ||
        '^FO495,172^A0N,20,20^FD  '||CASE WHEN J.PESAVEL = 'S' THEN 'KG' ELSE 'CADA' END||'  ^FS'|| CHR(13) || CHR(10) ||
        '^FO275,175^A0N,33,33^FDATACADO^FS'|| CHR(13) || CHR(10) ||
        '^FO275,210^A0N,19,19^FDA PARTIR DE '||LPAD(ATAC.QTDEMBALAGEM,2,0)||CASE WHEN J.PESAVEL = 'S' THEN ' KG' ELSE ' UNID.' END||'^FS'|| CHR(13) || CHR(10) ||
        '^FO580,167^A0N,58,58^FD'||LPAD(TRUNC(ATAC.PRECOATAC * J.QTDEMBALAGEM), 4, ' ' ) || ','||
                                   LPAD(((ATAC.PRECOATAC * J.QTDEMBALAGEM) -
                                   TRUNC((ATAC.PRECOATAC * J.QTDEMBALAGEM))) * 100, 2, 0)||'^FR^FS'|| CHR(13) || CHR(10) ||
        (CASE WHEN J.MULTEQPEMB IS NOT NULL  OR J.MULTEQPEMBALAGEM IS NOT NULL THEN
        '^FO590,221^A0N,15,15^FDNesta Embalagem '||
                                CASE WHEN J.MULTEQPEMBALAGEM = 'LI' THEN 'LT' WHEN  J.MULTEQPEMBALAGEM = 'GR' THEN '100g' WHEN J.MULTEQPEMBALAGEM = 'ML' THEN '100ml' ELSE J.MULTEQPEMBALAGEM END ||' R$ ' ||
                                DECODE(SIGN(ATAC.PRECOATAC * J.QTDEMBALAGEM),+1,
                                TRANSLATE(TO_CHAR(ROUND(((ATAC.PRECOATAC * J.QTDEMBALAGEM)/(J.MULTEQPEMB*1000)) * CASE WHEN J.MULTEQPEMBALAGEM IN ('GR','ML') THEN 100000 ELSE 1000 END ,2),'FM9990.00'), '.', ','),
                                TRANSLATE(TO_CHAR(ROUND(((ATAC.PRECOATAC * J.QTDEMBALAGEM)/(J.MULTEQPEMB*1000)) * CASE WHEN J.MULTEQPEMBALAGEM IN ('GR','ML') THEN 100000 ELSE 1000 END ,2),'FM9990.00'), '.', ',')) END)||'^FS'|| CHR(13) || CHR(10) ||
        '^FO490,155^GB300,86,51^FR^FS'     || CHR(13) || CHR(10) ||
        -- QrCode
        '^LH0,0^FO50,70^BQN,2,4 ^FDMA,'||CASE WHEN J.NROSEGMENTO NOT IN (8,4) THEN 'qrco.de/bg6UzU' ELSE 'qrco.de/bg0jxt' END||'^FS'     || CHR(13) || CHR(10) ||
        -- Imagem | Logo
        CASE WHEN J.NROSEGMENTO NOT IN (8,4) THEN
        '^FO150,80^GFA,780,780,10,,::::::N01FFE,M01JFC,M07KF8,L03MF,L0NF8,K01NFE,K07OF8,K0PFC,J01PFE,J03QF,J07QF8,J0RFC,I01RFE,I03KF00LF,I03JF8001KF,I07IFEJ07JF8,I0JFCJ03JFC,I0JFK01JFC,001IFEL0JFE,001IFCL07IFE,003IFCL03JF,003IF8L03JF,007IF8L01JF,007IFI07C001JF8,007IFI0FFI0JF8,007IF001FF800JF8,00IFE003FFC00JF8,00IFE003FFC007IFC,00IFE007FFC007IFC,:00IFE007FFE007IFC,:::::::::007FFE007FFE007IF8,:007FFE007FFE003IF8,007FFE007FFE001IF,003FFE007IFI01FF,:003FFE007IF8003FE,001FFE007IFC007FE,001IF00KF01FFC,I0TFC,I07SF8,:I03SF,I01RFE,I01RFC,J0RFC,J07QF8,J03QF,J01PFC,K0PF8,K03OF,L0NFC,L07MF8,L01LFE,M03KF,N07IF8,,::::^FS'
             WHEN J.NROSEGMENTO IN (8,4)     THEN
        '^FO145,50^GFA,960,960,12,,::::::::Q0FF8,O03JFE,N01LFC,N07MF,M01NFC,M07OF,M0PF8,L03PFE,L07QF,L0RF8,K01RFC,K03RFE,K07SF,K0IFC01FE00JF8,K0FFEI078003IF8,J01FFCI03J0IFC,J01FF8N07FFE,J03FFO03FFE,J03FEO03IF,J07FEO01IF,J07FCP0IF,J0FFC006I01800IF8,J0FF801F8007E00IF8,J0FF803FC00FF007FF8,:J0FF803FE01FF007FFC,J0FF807FE01FF007FFC,:I01FF807FE01FF007FFC,J0FF807FE01FF007FFC,:::J0FF807FE01FF007FF8,:J0FF807FE01FF003FF8,J07F807FE01FF8003F8,J07F807FE01FF8003F,J07F807FE01FFC007F,J03F807FE01FFE00FF,J03FC07FE03IF83FE,J01TFC,K0TFC,K0TF8,K07SF8,K07SF,K07RFE,K07RFC,K0SF8,K0SF,K0RFC,K0RF8,K0QFE,J01QFC,J01QF,J01IFC7KF8,J01FFE00JFC,J01FF8,J01FC,J03F,J038,J02,,::::::::^FS'
        END        || CHR(13) || CHR(10) || '^FO490,60^GB300,85,50^FR^FS'

        -- Fim A Partir De Gerenciador de Precos

----------- INICIO PRECO UNICO NORMAL OU PROMOCAO FOR MAIOR QUE NORMAL
       -- Tipo F

         WHEN /*ROUND (A.PRECO1/A.QTDEMBALAGEM1,2) = TRUNC((A.PRECOEMBPADRAO/A.PADRAOEMBVENDA),2) OR*/
           (NVL(A.PRECOVALIDPROMOC,0) >= TRUNC((A.PRECOVALIDNORMAL/A.PADRAOEMBVENDA),2)) OR NVL(A.PRECOVALIDPROMOC,0) = 0
           THEN  CHR(13) || CHR(10) ||
        '^FO50,20^A0N,40,40^FD'||SUBSTR(A.DESCCOMPLETA,0,37) ||' '||CASE WHEN J.QTDEMBALAGEM > 1 THEN J.EMBALAGEM ELSE NULL END||'^FS' || CHR(13) || CHR(10) || -- DESC
        '^FO050,185^BY2.4^BEN,30,Y,N^FD' || CASE WHEN J.QTDEMBALAGEM > 1 THEN NVL(NAGF_BUSCADUN(A.SEQPRODUTO, J.QTDEMBALAGEM), 0) ELSE A.CODACESSOPADRAO END ||'^FS' --EAN COD BARRAS
      --- QR CODE ETIQUERA NORMAL
      || CHR(13) || CHR(10) ||'^FO260,120^A0N,110,60^FDR$^FS' ||'^FS' -- R$
      || CHR(13) || CHR(10) ||'^FO450,90^A0N,170,130^FD'||TO_CHAR(J.PRECOVALIDNORMAL,'FM999G999G990D90', 'NLS_NUMERIC_CHARACTERS='',.''')|| '^FS'

----PRECO POR KG OU LI OU ETC...
||    (CASE WHEN
       J.MULTEQPEMB IS NOT NULL  OR J.MULTEQPEMBALAGEM IS NOT NULL
       THEN
CHR(13) || CHR(10) || '^FO550,250^A0N,15,16^FD' ||/* '*PRECO PAGO POR ' || J.MULTEQPEMBALAGEM ||' R$   '*/'Nesta Embalagem ' || CASE WHEN J.MULTEQPEMBALAGEM = 'LI' THEN 'LT'
                                                                                                                                                                                                                                                                    WHEN  J.MULTEQPEMBALAGEM = 'GR' THEN '100g' WHEN J.MULTEQPEMBALAGEM = 'ML' THEN '100ml'
                                                                                                                                                                                                                                                                   ELSE J.MULTEQPEMBALAGEM END ||' R$ '
      || DECODE(SIGN(J.PRECOGERPROMOC/*J.PRECOGERNORMAL*/),+1,
       TRANSLATE(TO_CHAR(ROUND((J.PRECOGERPROMOC/(J.MULTEQPEMB*1000)) * CASE WHEN J.MULTEQPEMBALAGEM IN ('GR','ML') THEN 100000 ELSE 1000 END ,2),'FM9990.00'), '.', ','),
       TRANSLATE(TO_CHAR(ROUND((J.PRECOGERNORMAL/(J.MULTEQPEMB*1000)) * CASE WHEN J.MULTEQPEMBALAGEM IN ('GR','ML') THEN 100000 ELSE 1000 END ,2),'FM9990.00'), '.', ','))
|| CHR(13) || CHR(10) || ''
END)||'^FR^FS'
      || CHR(13) || CHR(10) || '^LH0,0^FO50,70^BQN,2,4 ^FDMA,'||CASE WHEN J.NROSEGMENTO NOT IN (8,4) THEN 'qrco.de/bg6UzU' ELSE 'qrco.de/bg0jxt' END||'^FS'  -- QrCode
      || CHR(13) || CHR(10) || '^FO50,250^A0N,15,16^FD'||'LOJA:'|| G.NOMEREDUZIDO || ' F'||'^FS'
      || CHR(13) || CHR(10) || '^FO210,250^A0N,15,16^FD' ||  TO_CHAR(SYSDATE, 'dd/mm/yy hh24:mi') || '^FS'
      -- Imagem | Logo
      || CHR(13) || CHR(10) ||
      CASE WHEN J.NROSEGMENTO NOT IN (8,4) THEN
        '^FO150,80^GFA,780,780,10,,::::::N01FFE,M01JFC,M07KF8,L03MF,L0NF8,K01NFE,K07OF8,K0PFC,J01PFE,J03QF,J07QF8,J0RFC,I01RFE,I03KF00LF,I03JF8001KF,I07IFEJ07JF8,I0JFCJ03JFC,I0JFK01JFC,001IFEL0JFE,001IFCL07IFE,003IFCL03JF,003IF8L03JF,007IF8L01JF,007IFI07C001JF8,007IFI0FFI0JF8,007IF001FF800JF8,00IFE003FFC00JF8,00IFE003FFC007IFC,00IFE007FFC007IFC,:00IFE007FFE007IFC,:::::::::007FFE007FFE007IF8,:007FFE007FFE003IF8,007FFE007FFE001IF,003FFE007IFI01FF,:003FFE007IF8003FE,001FFE007IFC007FE,001IF00KF01FFC,I0TFC,I07SF8,:I03SF,I01RFE,I01RFC,J0RFC,J07QF8,J03QF,J01PFC,K0PF8,K03OF,L0NFC,L07MF8,L01LFE,M03KF,N07IF8,,::::^FS'
             WHEN J.NROSEGMENTO IN (8,4)     THEN
        '^FO145,50^GFA,960,960,12,,::::::::Q0FF8,O03JFE,N01LFC,N07MF,M01NFC,M07OF,M0PF8,L03PFE,L07QF,L0RF8,K01RFC,K03RFE,K07SF,K0IFC01FE00JF8,K0FFEI078003IF8,J01FFCI03J0IFC,J01FF8N07FFE,J03FFO03FFE,J03FEO03IF,J07FEO01IF,J07FCP0IF,J0FFC006I01800IF8,J0FF801F8007E00IF8,J0FF803FC00FF007FF8,:J0FF803FE01FF007FFC,J0FF807FE01FF007FFC,:I01FF807FE01FF007FFC,J0FF807FE01FF007FFC,:::J0FF807FE01FF007FF8,:J0FF807FE01FF003FF8,J07F807FE01FF8003F8,J07F807FE01FF8003F,J07F807FE01FFC007F,J03F807FE01FFE00FF,J03FC07FE03IF83FE,J01TFC,K0TFC,K0TF8,K07SF8,K07SF,K07RFE,K07RFC,K0SF8,K0SF,K0RFC,K0RF8,K0QFE,J01QFC,J01QF,J01IFC7KF8,J01FFE00JFC,J01FF8,J01FC,J03F,J038,J02,,::::::::^FS'
        END      || CHR(13) || CHR(10) || '^FO320,250^A0N,15,16^FD'  || 'PROD:'|| A.SEQPRODUTO ||'^FS' -- COD INTERNO


 ------------INICIO PRECO UNICO CASO NAO ESTEJA EM OFERTA E TENHA PRECOS DIF POR EMBALAGENS
        -- Tipo F

         WHEN TRUNC(A.PRECO1/A.QTDEMBALAGEM1,2) = TRUNC((A.PRECOEMBPADRAO/A.PADRAOEMBVENDA),2) AND (NVL(A.PRECOVALIDPROMOC,0) = 0)
           THEN  CHR(13) || CHR(10) ||
      '^FO50,20^A0N,40,40^FD'||SUBSTR(A.DESCCOMPLETA,0,37) ||' '||CASE WHEN J.QTDEMBALAGEM > 1 THEN J.EMBALAGEM ELSE NULL END||'^FS' || CHR(13) || CHR(10) || -- DESC
    --  || CHR(13) || CHR(10) || '^FO050,200^BY2.4^BEN,30,Y,N^FD' || CASE WHEN J.QTDEMBALAGEM > 1 THEN NVL(NAGF_BUSCADUN(A.SEQPRODUTO, J.QTDEMBALAGEM), 0) ELSE A.CODACESSOPADRAO END ||'^FS' --EAN COD BARRAS
       DECODE(LENGTH(CASE WHEN J.QTDEMBALAGEM > 1 THEN NVL(NAGF_BUSCADUN(A.SEQPRODUTO, J.QTDEMBALAGEM), 0) ELSE A.CODACESSOPADRAO END),13, '^FO050,185^BY2.4^BEN,30,Y,N^FD', '^FO050,185^BY2.4^BCN,30,Y,N^FD' ) || CASE WHEN J.QTDEMBALAGEM > 1 THEN NVL(NAGF_BUSCADUN(A.SEQPRODUTO, J.QTDEMBALAGEM), 0) ELSE A.CODACESSOPADRAO END ||'^FS' --EAN COD BARRAS BARRAS
        --- QR CODE ETIQUERA NORMAL
      || CHR(13) || CHR(10) ||'^FO260,120^A0N,110,60^FDR$^FS' ||'^FS' -- R$
      || CHR(13) || CHR(10) ||'^FO350,90^A0N,170,130^FD'|| TO_CHAR(J.PRECOVALIDNORMAL,'FM999G999G990D90', 'NLS_NUMERIC_CHARACTERS='',.''')|| '^FS'

----PRECO POR KG
||    (CASE WHEN
       J.MULTEQPEMB IS NOT NULL  OR J.MULTEQPEMBALAGEM IS NOT NULL
       THEN
CHR(13) || CHR(10) || '^FO550,250^A0N,15,16^FD' || /*'*PRECO PAGO POR ' || J.MULTEQPEMBALAGEM ||' R$   '*/ 'Nesta Embalagem ' || CASE WHEN J.MULTEQPEMBALAGEM = 'LI' THEN 'LT'
                                                                                                                                                                                                                                                                    WHEN  J.MULTEQPEMBALAGEM = 'GR' THEN '100g' WHEN J.MULTEQPEMBALAGEM = 'ML' THEN '100ml'
                                                                                                                                                                                                                                                                     ELSE J.MULTEQPEMBALAGEM END ||' R$ '
      || DECODE(SIGN(J.PRECOGERPROMOC/*J.PRECOGERNORMAL*/),+1,
       TRANSLATE(TO_CHAR(ROUND((J.PRECOGERPROMOC/(J.MULTEQPEMB*1000)) * CASE WHEN J.MULTEQPEMBALAGEM IN ('GR','ML') THEN 100000 ELSE 1000 END ,2),'FM9990.00'), '.', ','),
       TRANSLATE(TO_CHAR(ROUND((J.PRECOGERNORMAL/(J.MULTEQPEMB*1000)) * CASE WHEN J.MULTEQPEMBALAGEM IN ('GR','ML') THEN 100000 ELSE 1000 END ,2),'FM9990.00'), '.', ','))
|| CHR(13) || CHR(10) || ''
END)||'^FR^FS'
      || CHR(13) || CHR(10) || '^LH0,0^FO50,70^BQN,2,4 ^FDMA,'||CASE WHEN J.NROSEGMENTO NOT IN (8,4) THEN 'qrco.de/bg6UzU' ELSE 'qrco.de/bg0jxt' END||'^FS'  -- QrCode
      || CHR(13) || CHR(10) || '^FO50,250^A0N,15,16^FD'||'LOJA: '|| G.NOMEREDUZIDO || ' G' ||'^FS'
      -- Imagem | Logo
      || CHR(13) || CHR(10) ||
      CASE WHEN J.NROSEGMENTO NOT IN (8,4) THEN
        '^FO150,80^GFA,780,780,10,,::::::N01FFE,M01JFC,M07KF8,L03MF,L0NF8,K01NFE,K07OF8,K0PFC,J01PFE,J03QF,J07QF8,J0RFC,I01RFE,I03KF00LF,I03JF8001KF,I07IFEJ07JF8,I0JFCJ03JFC,I0JFK01JFC,001IFEL0JFE,001IFCL07IFE,003IFCL03JF,003IF8L03JF,007IF8L01JF,007IFI07C001JF8,007IFI0FFI0JF8,007IF001FF800JF8,00IFE003FFC00JF8,00IFE003FFC007IFC,00IFE007FFC007IFC,:00IFE007FFE007IFC,:::::::::007FFE007FFE007IF8,:007FFE007FFE003IF8,007FFE007FFE001IF,003FFE007IFI01FF,:003FFE007IF8003FE,001FFE007IFC007FE,001IF00KF01FFC,I0TFC,I07SF8,:I03SF,I01RFE,I01RFC,J0RFC,J07QF8,J03QF,J01PFC,K0PF8,K03OF,L0NFC,L07MF8,L01LFE,M03KF,N07IF8,,::::^FS'
             WHEN J.NROSEGMENTO IN (8,4)     THEN
        '^FO145,50^GFA,960,960,12,,::::::::Q0FF8,O03JFE,N01LFC,N07MF,M01NFC,M07OF,M0PF8,L03PFE,L07QF,L0RF8,K01RFC,K03RFE,K07SF,K0IFC01FE00JF8,K0FFEI078003IF8,J01FFCI03J0IFC,J01FF8N07FFE,J03FFO03FFE,J03FEO03IF,J07FEO01IF,J07FCP0IF,J0FFC006I01800IF8,J0FF801F8007E00IF8,J0FF803FC00FF007FF8,:J0FF803FE01FF007FFC,J0FF807FE01FF007FFC,:I01FF807FE01FF007FFC,J0FF807FE01FF007FFC,:::J0FF807FE01FF007FF8,:J0FF807FE01FF003FF8,J07F807FE01FF8003F8,J07F807FE01FF8003F,J07F807FE01FFC007F,J03F807FE01FFE00FF,J03FC07FE03IF83FE,J01TFC,K0TFC,K0TF8,K07SF8,K07SF,K07RFE,K07RFC,K0SF8,K0SF,K0RFC,K0RF8,K0QFE,J01QFC,J01QF,J01IFC7KF8,J01FFE00JFC,J01FF8,J01FC,J03F,J038,J02,,::::::::^FS'
        END      || CHR(13) || CHR(10) || '^FO210,250^A0N,15,16^FD' ||  TO_CHAR(SYSDATE, 'dd/mm/yy hh24:mi') || '^FS'
      || CHR(13) || CHR(10) || '^FO320,250^A0N,15,16^FD'  || ' PROD: '|| A.SEQPRODUTO ||'^FS' -- COD INTERNO
      ---FO645,265^A0N,13,16^FD



END


--FIM DA ETIQUETA
|| CHR(13) || CHR(10) || '^XZ'
|| CHR(13) || CHR(10) LINHA

FROM CONSINCO.MRLX_BASEETIQUETAPROD A INNER JOIN CONSINCO.MRLV_BASEETIQUETAPROD_NAGV2 J ON J.NROEMPRESA  = A.NROEMPRESA AND J.SEQPRODUTO = A.SEQPRODUTO AND J.NROSEGMENTO = A.NROSEGMENTO AND J.QTDEMBALAGEM = A.QTDEMBCODACESSO
                                      INNER JOIN CONSINCO.MAX_EMPRESA G               ON G.NROEMPRESA  = A.NROEMPRESA AND G.NROSEGMENTOPRINC = A.NROSEGMENTO
                                       LEFT JOIN NAGV_BASE_PROMOC_PDV PPDV ON PPDV.SEQPRODUTO = A.SEQPRODUTO AND PPDV.NROEMPRESA = A.NROEMPRESA
                                       LEFT JOIN NAGV_BASE_PROMOC_PRECO2 P ON P.NROEMPRESA  = A.NROEMPRESA AND P.SEQPRODUTO = A.SEQPRODUTO AND P.NROSEGMENTO = A.NROSEGMENTO AND P.QTDEMBALAGEM = A.QTDEMBCODACESSO
                                       LEFT JOIN (SELECT ROUND ((ATAC.PRECOVALIDNORMAL / ATAC.QTDEMBALAGEM),2) PRECOATAC,
                                                                 ROUND((ATAC.PRECOGERNORMAL / ATAC.QTDEMBALAGEM),2) PRECOATACGER,
                                                                 ATAC.SEQPRODUTO,
                                                                 ATAC.NROEMPRESA, ATAC.NROSEGMENTO,
                                                                 ATAC.QTDEMBALAGEM QTDEMBALAGEM
                                                            FROM MRL_PRODEMPSEG ATAC
                                                           WHERE ATAC.QTDEMBALAGEM > 1
                                                             AND ATAC.PRECOVALIDNORMAL/ATAC.QTDEMBALAGEM < ATAC.PRECOVALIDNORMAL
                                                             AND ATAC.STATUSVENDA = 'A'
                                                             AND EXISTS (SELECT 1
                                                                           FROM CONSINCO.MAX_EMPRESA XK
                                                                          WHERE XK.NROSEGMENTOPRINC = ATAC.NROSEGMENTO
                                                                            AND XK.NROEMPRESA = ATAC.NROEMPRESA)
                                                             AND ATAC.QTDEMBALAGEM =
                                                                 (SELECT MIN(EMPS.QTDEMBALAGEM)
                                                                        FROM MRL_PRODEMPSEG EMPS
                                                                       WHERE EMPS.SEQPRODUTO = ATAC.SEQPRODUTO
                                                                         AND EMPS.NROEMPRESA = ATAC.NROEMPRESA
                                                                         AND EMPS.NROSEGMENTO = ATAC.NROSEGMENTO
                                                                         AND EMPS.PRECOVALIDNORMAL/EMPS.QTDEMBALAGEM < ATAC.PRECOVALIDNORMAL
                                                                         AND EMPS.QTDEMBALAGEM > 1)
                                                           ) ATAC ON ATAC.NROEMPRESA  = A.NROEMPRESA
                                                                                                           AND ATAC.NROSEGMENTO = A.NROSEGMENTO
                                                                                                           AND ATAC.SEQPRODUTO  = A.SEQPRODUTO
                                       -- Precos Meu Nagumo - Identificados
                                       LEFT JOIN (SELECT PRECOPPROMOCIONAL, CODLOJA, CODIGOPRODUTO, RP.DTINICIO, RP.DTFIM
                                                    FROM CONSINCO.NAGT_REMARCAPROMOCOES RP
                                                   WHERE SYSDATE BETWEEN RP.DTHRINICIO AND RP.DTHRFIM -- Ajustado a view para tratativa de hora/min na DTFIM | 19/03/2024
                                                     AND RP.TIPODESCONTO  = 4
                                                     AND RP.PROMOCAOLIVRE = 0) RPM ON RPM.CODLOJA = A.NROEMPRESA
                                                                                 AND RPM.CODIGOPRODUTO = LPAD(A.CODACESSOPADRAO,14,0)


  ORDER BY LINHA
;
