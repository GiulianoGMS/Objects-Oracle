CREATE OR REPLACE PROCEDURE CONSINCO.NAGP_CUPONSIDENTIFICADOS (pData IN DATE) IS

   BEGIN
      
      DELETE FROM NAGT_CUPONSIDENTIFICADOS@CONSINCODW WHERE DATA = pData;
   
      INSERT INTO NAGT_CUPONSIDENTIFICADOS@CONSINCODW (LOJA, OPERADOR, NOME, DATA, TOTAL_CUPONS, TOTAL_CUPONS_IDENTIFICADOS)
      SELECT LOJA, OPERADOR, NOME, DATA, TOTAL_CUPONS, TOTAL_CUPONS_IDENTIFICADOS FROM NAGV_CUPONSIDENTIFICADOS WHERE DATA = pData;
            
      EXCEPTION
         WHEN OTHERS THEN
           DBMS_OUTPUT.PUT_LINE(SQLERRM);
                 
      COMMIT;
      
   END;
   
      
BEGIN CONSINCO.NAGP_CUPONSIDENTIFICADOS(TRUNC(SYSDATE -1));

END;

SELECT * FROM NAGT_CUPONSIDENTIFICADOS@CONSINCODW ORDER BY DATA DESC;
    
-- Insere dados historicos 

INSERT INTO NAGT_CUPONSIDENTIFICADOS@CONSINCODW (LOJA, OPERADOR, NOME, DATA, TOTAL_CUPONS, TOTAL_CUPONS_IDENTIFICADOS)
       SELECT LOJA, OPERADOR, NOME, DATA, TOTAL_CUPONS, TOTAL_CUPONS_IDENTIFICADOS FROM NAGV_CUPONSIDENTIFICADOS WHERE DATA BETWEEN '01-JAN-2023' AND '23-JAN-2023';
COMMIT;
 
SELECT COUNT(1) FROM NAGT_CUPONSIDENTIFICADOS@CONSINCODW WHERE DATA = TRUNC(SYSDATE -1)
