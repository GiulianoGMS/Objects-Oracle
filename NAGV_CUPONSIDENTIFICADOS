CREATE OR REPLACE VIEW CONSINCO.NAGV_CUPONSIDENTIFICADOS AS
SELECT X.NROEMPRESA LOJA,
           X.SEQOPERADOR OPERADOR,
					 NVL(Z.NOME,K.NOME) NOME,
					 X.DTAMOVIMENTO DATA,
					 COUNT(DISTINCT X.SEQDOCTO) TOTAL_CUPONS,
					 COUNT(DISTINCT W.SEQDOCTO) TOTAL_CUPONS_IDENTIFICADOS,
           ROUND(SUM(X.VLRTOTDOCTO) - SUM(X.VLRTOTDESCDOCTO),2) VALOR_TOTAL_CUPONS,
           ROUND(SUM(W.VLRTOTDOCTO),2) VALOR_TOTAL_CUPONS_IDENTIFICADOS
 FROM CONSINCO.PDV_DOCTO X  LEFT JOIN CONSINCO.PDV_DESCONTO W ON (X.SEQDOCTO = W.SEQDOCTO)
                                                     LEFT JOIN CONSINCO.FI_TSOPERADORCAIXA Z ON (Z.CODOPERADOR = X.SEQOPERADOR AND Z.NROEMPRESA = X.NROEMPRESA) -- OPERADORES PDV NORMAL
																										 LEFT JOIN CONSINCO.GE_USUARIO K ON (K.SEQUSUARIO = X.SEQOPERADOR) -- OPERADORES GZ (LOJA 51)
WHERE 1=1
  AND X.TIPODOCTO = 'CF'
  AND X.STATUSDOCTO = 'V'
	GROUP BY X.NROEMPRESA,
           X.SEQOPERADOR,	 Z.NOME,K.NOME,
					 X.DTAMOVIMENTO
;
