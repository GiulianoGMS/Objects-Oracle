CREATE OR REPLACE VIEW CONSINCO.NAGV_VENDADIASEMANA AS 

SELECT NROEMPRESA, SEQPRODUTO, DIA_SEMANA, SUM(QTD) QTD_VDA FROM (

SELECT  MF.NROEMPRESA, SEQPRODUTO, 
        TO_CHAR(DTAEMISSAO, 'Day' , 'NLS_DATE_LANGUAGE=PORTUGUESE') DIA_SEMANA, 
        SUM(MFI.QUANTIDADE) QTD
    
  FROM CONSINCO.MLF_NOTAFISCAL MF LEFT JOIN CONSINCO.MLF_NFITEM MFI ON MF.SEQAUXNOTAFISCAL = MFI.SEQAUXNOTAFISCAL
      
WHERE 1=1
  AND MF.CODGERALOPER IN (37,48,123,610,615,613,810,916,910,911)
 -- AND MF.NROEMPRESA = &Loja
  AND MF.DTAEMISSAO > SYSDATE - 30
  AND MF.STATUSNF != 'C'
 -- AND SEQPRODUTO = &SeqProduto
  GROUP BY MF.NROEMPRESA, SEQPRODUTO, TO_CHAR(DTAEMISSAO, 'Day' , 'NLS_DATE_LANGUAGE=PORTUGUESE')
  
  UNION ALL
  
SELECT  MD.NROEMPRESA, SEQPRODUTO, 
        TO_CHAR(DTAMOVIMENTO, 'Day' , 'NLS_DATE_LANGUAGE=PORTUGUESE') DIA_SEMANA, SUM(MDI.QUANTIDADE) QTD
    
  FROM CONSINCO.MFL_DOCTOFISCAL MD LEFT JOIN CONSINCO.MFL_DFITEM MDI ON MD.SEQNF = MDI.SEQNF
      
WHERE 1=1
  AND MD.CODGERALOPER IN (37,48,123,610,615,613,810,916,910,911)
 -- AND MD.NROEMPRESA = &Loja
  AND MD.DTAMOVIMENTO > SYSDATE - 30
  AND MD.STATUSDF != 'C'
 -- AND SEQPRODUTO = &SeqProduto
  GROUP BY MD.NROEMPRESA, SEQPRODUTO, TO_CHAR(DTAMOVIMENTO, 'Day' , 'NLS_DATE_LANGUAGE=PORTUGUESE'))
  
  GROUP BY NROEMPRESA, SEQPRODUTO, DIA_SEMANA
