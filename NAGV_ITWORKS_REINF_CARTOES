CREATE OR REPLACE VIEW CONSINCO.NAGV_ITWORKS_REINF_CARTOES AS
SELECT /*Adm. de Cartões - Chamado 268630 - Amalia Petronilio | Criado por Giuliano em 07/08/2023*/
       DISTINCT X.NROEMPRESA LOJA,
      (SELECT LPAD(MA.NROCGC,12,0)||LPAD(MA.DIGCGC,2,0) FROM CONSINCO.MAX_EMPRESA MA WHERE MA.NROEMPRESA = X.NROEMPRESA) CNPJ_EMP,
       TO_CHAR(X.DTAINCLUSAO, 'MM') MES_LANCTO, TO_CHAR(X.DTAINCLUSAO, 'YYYY') ANO_LANCTO,
       B.NOMERAZAO RAZAO_SOCIAL, LPAD(B.NROCGCCPF,12,0)||LPAD(B.DIGCGCCPF,2,0) CNPJ,
       TO_CHAR(SUM(X.VLRADMINISTRACAO), 'FM999G999G990D90', 'NLS_NUMERIC_CHARACTERS='',.''') VALOR_COMISSAO

      FROM CONSINCO.FI_TITULO X INNER JOIN CONSINCO.GE_PESSOA B ON X.SEQPESSOA = B.SEQPESSOA
                                INNER JOIN CONSINCO.GE_EMPRESA C ON X.NROEMPRESA = C.NROEMPRESA

 WHERE X.CODESPECIE IN ('CARDEB', 'CARTAO', 'TICKET', 'AMERIC') -- Somente cartões - Solic Amalia
   AND X.SITUACAO != 'C'
   AND X.SEQPESSOA != 602 -- Retirado Bluecard

 GROUP BY X.NROEMPRESA, TO_CHAR(X.DTAINCLUSAO, 'MM'), TO_CHAR(X.DTAINCLUSAO, 'YYYY'),
       B.NOMERAZAO , LPAD(B.NROCGCCPF,12,0)||LPAD(B.DIGCGCCPF,2,0)
;
